#!/usr/bin/env bash
# Security Pre-Push Hook
# Automatically sanitizes sensitive information before pushing
# Version: 2.0.0 - Auto-sanitize mode

set -e

# Sensitive patterns and their replacements
REAL_EMAIL="steele.thompson13@gmail.com"
PLACEHOLDER_EMAIL="YOUR_EMAIL@example.com"

# Files to sanitize (exclude backups and build artifacts)
FILES_TO_SANITIZE=(
    "config.toml"
    "README.md"
    "QUICKSTART.md"
    "TASKS.md"
    "CONTRIBUTING.md"
    "TROUBLESHOOTING.md"
)

# Track if any files were sanitized
SANITIZED=false

echo "üîí Running pre-push security check..."

for file in "${FILES_TO_SANITIZE[@]}"; do
    if [ -f "$file" ]; then
        if grep -q "$REAL_EMAIL" "$file" 2>/dev/null; then
            # Sanitize the file
            sed -i '' "s/$REAL_EMAIL/$PLACEHOLDER_EMAIL/g" "$file"
            
            # Stage the sanitized version
            git add "$file"
            
            echo "  ‚úì Sanitized: $file"
            SANITIZED=true
        fi
    fi
done

if [ "$SANITIZED" = true ]; then
    echo ""
    echo "‚úÖ Email addresses sanitized automatically"
    echo "   Real email ‚Üí Placeholder for public repo"
    echo ""
    echo "‚ö†Ô∏è  Note: Your local working files will be updated."
    echo "   After push, restore with: git checkout HEAD -- config.toml README.md ..."
    echo "   Or the files will auto-restore on next pull/checkout"
fi

exit 0
