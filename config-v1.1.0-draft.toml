#:schema https://jj-vcs.github.io/jj/latest/config-schema.json

# ============================================================================
# JJ Configuration - Version 1.1.0-mcp-integration
# Created: 2025-11-07
#
# Additional configurations available in:
# - ~/.config/jj/aliases/          (Command aliases - tier2, tier3, advanced, community)
# - ~/.config/jj/revsets/          (Revset aliases - tier2, tier3, community)
# - ~/.config/jj/git-configs/      (Git settings - tier2, tier3)
# - ~/.config/jj/ui-configs/       (UI settings, Synthwave84 colors - tier2, tier3)
# - ~/.config/jj/template-configs/ (Template aliases - tier2, tier3, community)
# - ~/.config/jj/revsets-config/   (Revsets section settings - tier2, tier3, willhbr)
# - ~/.config/jj/templates/        (Hook templates, workflow templates)
# ============================================================================

# User Information
[user]
name = "Thomo1318"
email = "YOUR_EMAIL@example.com"

# UI Settings
[ui]
editor = "micro"
# Use diff-so-fancy via a wrapper script or pipe, but for a true editor integration, 'delta' is often preferred in terminals.
# Since you have delta/diff-so-fancy, let's configure delta as the pager for diffs which is the standard "optimal" way.
# For the actual 3-pane diff editor, use a GUI or keep jj-fzf? keeping jj-fzf as diff-editor for now.
diff-editor = "jj-fzf"
diff-formatter = ":color-words"
# Better conflict markers
conflict-marker-style = "snapshot"
# Optimal Pager: Delta (Syntax highlighting for diffs)
pager = "delta"
graph.style = "curved"
log-word-wrap = true
default-command = ["log"]
color = "always"

[ui.diff]
tool = "difft" # Use difftastic by default for 'jj diff' content

# Core Settings
[core]
fsmonitor = "watchman" # Instant file updates

# Merge Tools - Difftastic (Semantic Diff)
[merge-tools]
difft = { program = "difft", diff-args = ["--color=always", "$left", "$right"] }

# Snapshot Safety
[snapshot]
max-new-file-size = "10MiB"

# Git Integration
[git]
push-new-bookmarks = true
auto-local-bookmark = true
fetch = "glob:*"
private-commits = "description(glob:'wip:*') | description(glob:'private:*')"

# Templates
[templates]
log = "builtin_log_comfortable"
show = "builtin_log_detailed"
op_log = "builtin_op_log_comfortable"
git_push_bookmark = '"Thomo1318/push-" ++ change_id.short()'

# Template Aliases
[template-aliases]
'format_short_id(id)' = "id.shortest()"
'format_short_change_id(id)' = "format_short_id(id)"
'format_timestamp(timestamp)' = 'timestamp.format("%Y-%m-%d %H:%M")'
'format_short_signature(signature)' = "signature.email().local()"
'format_short_operation_id(id)' = "id.shortest()"
'format_field(key, value)' = 'key ++ ": " ++ value ++ "\n"'

# Revset Aliases
[revset-aliases]
'mine()' = 'author("YOUR_EMAIL@example.com") | committer("YOUR_EMAIL@example.com")'
'trunk()' = 'latest(remote_bookmarks(exact:"main") | remote_bookmarks(exact:"master") | remote_bookmarks(exact:"trunk"))'
'work' = "ancestors(mutable() & ~empty(), 2) | trunk()"
'recent()' = "ancestors(@, 10)"
'p(n)' = "@-n"
'p(r, n)' = "r-n"
'active(rev)' = "ancestors(rev) | descendants(rev) | rev"

# Revsets Section
[revsets]
log = "@ | ancestors(immutable_heads().., 2) | trunk()"
short-prefixes = "(trunk()..@)::"

# Command Aliases
[aliases]
# Basic operations
st = ["status"]
d = ["diff"]
ds = ["diff", "--stat"]
s = ["show"]
c = ["commit"]
ci = ["commit", "--interactive"]
# Log viewing
l = ["log"]
ll = ["log", "--limit", "20"]
lll = ["log", "--limit", "50"]
# Editing
e = ["edit"]
amend = ["squash"]
# Rebase
r = ["rebase"]
# Git integration
pull = ["git", "fetch"]
push = ["git", "push", "--allow-new"]
sync = ["git", "fetch", "--all-remotes"]
# New changes
n = ["new"]
co = ["new"]
# TUI launchers
fzf = ["!jj-fzf"]
tui = ["!lazyjj"]
ui = ["!gg"]
# Repository Initialization (v1.1.0 - MCP-enabled by default)
init = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  '''
set -e
echo "Initializing jj repository with GitMCP integration..."

# Initialize jj repo
jj git init --colocate

# Install GitMCP hooks
mkdir -p .git/hooks

# Install post-commit hook
cp ~/.config/jj/templates/mcp-hooks/post-commit .git/hooks/post-commit
chmod +x .git/hooks/post-commit

# Install post-merge hook
cp ~/.config/jj/templates/mcp-hooks/post-merge .git/hooks/post-merge
chmod +x .git/hooks/post-merge

# Install post-checkout hook
cp ~/.config/jj/templates/mcp-hooks/post-checkout .git/hooks/post-checkout
chmod +x .git/hooks/post-checkout

# Generate initial MCP context
.git/hooks/post-commit

echo "✓ Repository initialized"
echo "✓ GitMCP hooks installed"

# Show MCP URL if GitHub repo
REMOTE=$(git remote get-url origin 2>/dev/null | sed "s/.*github.com[:/]//" | sed "s/.git$//" || echo "")
if [ -n "$REMOTE" ]; then
    echo "✓ GitMCP URL: https://gitmcp.io/$REMOTE"
    echo ""
    echo "AI Context files created in .mcp/"
    echo "See .mcp/README.md for integration instructions"
else
    echo "ℹ Local repo - MCP context generated for local use"
fi
''',
]
# Short version (same as init)
i = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  '''
set -e
jj git init --colocate
mkdir -p .git/hooks
cp ~/.config/jj/templates/mcp-hooks/post-commit .git/hooks/post-commit
cp ~/.config/jj/templates/mcp-hooks/post-merge .git/hooks/post-merge
cp ~/.config/jj/templates/mcp-hooks/post-checkout .git/hooks/post-checkout
chmod +x .git/hooks/post-*
.git/hooks/post-commit
REMOTE=$(git remote get-url origin 2>/dev/null | sed "s/.*github.com[:/]//" | sed "s/.git$//" || echo "")
[ -n "$REMOTE" ] && echo "GitMCP: https://gitmcp.io/$REMOTE" || echo "Local repo initialized"
''',
]
# Initialize without MCP (fallback)
init-simple = ["git", "init", "--colocate"]
# Install MCP hooks in existing repo
mcp-update = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  '''
set -e
echo "Installing GitMCP hooks in existing repository..."

mkdir -p .git/hooks

cp ~/.config/jj/templates/mcp-hooks/post-commit .git/hooks/post-commit
cp ~/.config/jj/templates/mcp-hooks/post-merge .git/hooks/post-merge
cp ~/.config/jj/templates/mcp-hooks/post-checkout .git/hooks/post-checkout
chmod +x .git/hooks/post-*

# Generate initial context
.git/hooks/post-commit

echo "✓ GitMCP hooks installed"
REMOTE=$(git remote get-url origin 2>/dev/null | sed "s/.*github.com[:/]//" | sed "s/.git$//" || echo "")
[ -n "$REMOTE" ] && echo "✓ GitMCP URL: https://gitmcp.io/$REMOTE"
''',
]
# Show GitMCP URL for current repo
mcp-url = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  '''
REMOTE=$(git remote get-url origin 2>/dev/null | sed "s/.*github.com[:/]//" | sed "s/.git$//" || echo "")
if [ -n "$REMOTE" ]; then
    echo "GitMCP URL: https://gitmcp.io/$REMOTE"
    echo ""
    echo "Copy this URL to your AI tool config:"
    echo "  - Cursor: ~/.cursor/mcp.json"
    echo "  - Claude: ~/Library/Application Support/Claude/claude_desktop_config.json"
    echo "  - VS Code: MCP extension settings"
else
    echo "Not a GitHub repository"
fi
''',
]
# Open GitMCP URL in browser
mcp-open = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  '''
REMOTE=$(git remote get-url origin 2>/dev/null | sed "s/.*github.com[:/]//" | sed "s/.git$//" || echo "")
if [ -n "$REMOTE" ]; then
    if command -v python3 >/dev/null 2>&1; then
        python3 -m webbrowser "https://gitmcp.io/$REMOTE"
    elif command -v open >/dev/null 2>&1; then
        open "https://gitmcp.io/$REMOTE"
    elif command -v xdg-open >/dev/null 2>&1; then
        xdg-open "https://gitmcp.io/$REMOTE"
    else
        echo "Please open: https://gitmcp.io/$REMOTE"
    fi
''',
]

# Synthwave84 Color Scheme
[colors]
"commit_id" = { fg = "#24decd", bold = true }
"commit_id prefix" = { fg = "#24decd", bold = true }
"change_id" = { fg = "#f15bb5", bold = true }
"change_id prefix" = { fg = "#f15bb5", bold = true }
"working_copy" = { fg = "#fe28a2", bold = true }
"working_copy commit_id" = { fg = "#fe28a2", underline = true }
"working_copy change_id" = { fg = "#fe28a2", underline = true }
"bookmark" = { fg = "#480ca8" }
"bookmark present" = { fg = "#480ca8", bold = true }
"tag" = { fg = "#f15bb5" }
"git_head" = { fg = "#24decd", bold = true }
"node" = { fg = "#480ca8" }
"node current_operation" = { fg = "#fe28a2", bold = true }
"node immutable" = { fg = "#261838" }
"node working_copy" = { fg = "#fe28a2" }
"diff header" = { fg = "#480ca8", bold = true }
"diff file_header" = { fg = "#f15bb5", bold = true }
"diff hunk_header" = { fg = "#24decd" }
"diff removed" = { fg = "#ff0080" }
"diff added" = { fg = "#24decd" }
"diff removed token" = { fg = "#ff0080", bg = "#261838", underline = false }
"diff added token" = { fg = "#24decd", bg = "#261838", underline = false }
"error" = { fg = "#fe28a2", bold = true }
"warning" = { fg = "#f15bb5", bold = true }
"hint" = { fg = "#24decd" }
"description placeholder" = { fg = "#480ca8", italic = true }
"empty" = { fg = "#261838" }
"conflict" = { fg = "#fe28a2", bold = true }
"email" = { fg = "#24decd" }
"timestamp" = { fg = "#480ca8" }
"rest" = { fg = "#f15bb5" }
